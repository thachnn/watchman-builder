diff --git a/CMakeLists.txt b/CMakeLists.txt
index 4415d95..f1125b5 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -35,7 +35,6 @@ option(USE_SYS_PYTHON
   ON
 )
 
-enable_testing()
 include_directories(${CMAKE_CURRENT_SOURCE_DIR})
 include_directories(${CMAKE_CURRENT_BINARY_DIR})
 include_directories("${CMAKE_CURRENT_SOURCE_DIR}/external/install/include")
@@ -93,6 +92,12 @@ set(WATCHMAN_VERSION_OVERRIDE "" CACHE STRING "Use this version code for \
 set(WATCHMAN_BUILDINFO_OVERRIDE "" CACHE STRING "Use this version code for \
     Watchman build info instead of the default (nothing)")
 
+if (WATCHMAN_BUILDINFO_OVERRIDE)
+  set(BUILD_INFO "${WATCHMAN_BUILDINFO_OVERRIDE}")
+elseif(DEFINED ENV{WATCHMAN_BUILDINFO_OVERRIDE})
+  set(BUILD_INFO "$ENV{WATCHMAN_BUILDINFO_OVERRIDE}")
+endif()
+
 if (WATCHMAN_VERSION_OVERRIDE)
   set(PACKAGE_VERSION "${WATCHMAN_VERSION_OVERRIDE}")
 elseif(DEFINED ENV{WATCHMAN_VERSION_OVERRIDE})
@@ -126,10 +131,12 @@ set(PACKAGE_TARNAME   "${PACKAGE_NAME}-${PACKAGE_VERSION}")
 set(PACKAGE_BUGREPORT "https://github.com/facebook/watchman/issues")
 project(${PACKAGE_NAME} CXX C)
 
+if (BUILD_TESTING)
 find_package(GMock MODULE REQUIRED)
 include_directories(${GMOCK_INCLUDEDIR} ${LIBGMOCK_INCLUDE_DIR})
 include(GoogleTest)
 enable_testing()
+endif()
 
 include(FBThriftCppLibrary)
 include(CheckFunctionExists)
@@ -149,6 +156,9 @@ endfunction()
 file(WRITE "${CMAKE_CURRENT_BINARY_DIR}/config.h.new" "#pragma once\n")
 
 if(NOT WIN32)
+  set(WATCHMAN_CONFIG_FILE "/etc/watchman.json" CACHE STRING
+    "Path of the default configuration file")
+
   set(WATCHMAN_STATE_DIR "${CMAKE_INSTALL_PREFIX}/var/run/watchman" CACHE STRING
     "Run-time path of the persistent state directory")
   set(INSTALL_WATCHMAN_STATE_DIR OFF CACHE BOOL
@@ -157,6 +167,9 @@ if(NOT WIN32)
     is owned by a non-privileged user but where the WATCHMAN_STATE_DIR requires
     administrative rights to create and set its permissions.")
 else()
+  set(WATCHMAN_CONFIG_FILE "C:/ProgramData/facebook/watchman.json" CACHE STRING
+    "Path of the default configuration file")
+
   set(WATCHMAN_STATE_DIR)
   set(INSTALL_WATCHMAN_STATE_DIR)
 endif()
@@ -169,12 +182,7 @@ if(WATCHMAN_STATE_DIR AND INSTALL_WATCHMAN_STATE_DIR)
 endif()
 
 config_h("// Generated by cmake")
-if(WIN32)
-  config_h("#define WATCHMAN_CONFIG_FILE \
-\"C:/ProgramData/facebook/watchman.json\"")
-else()
-  config_h("#define WATCHMAN_CONFIG_FILE \"/etc/watchman.json\"")
-endif()
+config_h("#define WATCHMAN_CONFIG_FILE \"${WATCHMAN_CONFIG_FILE}\"")
 
 if(WATCHMAN_STATE_DIR)
   config_h("#define WATCHMAN_STATE_DIR \"${WATCHMAN_STATE_DIR}\"")
@@ -366,6 +374,9 @@ else()
 endif()
 
 
+option(WITHOUT_PYTHON "Disable python bindings" OFF)
+if (NOT WITHOUT_PYTHON)
+
 if(NOT WIN32)
   # Sometimes the environment has a Python installation earlier in the
   # PATH that is not suitable for building extensions. Prefer the
@@ -420,6 +431,8 @@ if(Python3_Interpreter_FOUND AND NODE AND YARN)
   add_subdirectory(watchman/node/bser)
 endif()
 
+endif()
+
 if(CMAKE_SYSTEM_NAME STREQUAL "Windows")
   # Check target architecture
   if (NOT CMAKE_SIZEOF_VOID_P EQUAL 8)
@@ -437,7 +450,7 @@ if(CMAKE_SYSTEM_NAME STREQUAL "Windows")
   set(CMAKE_STATIC_LIBRARY_FLAGS
     "${CMAKE_STATIC_LIBRARY_FLAGS} /DEBUG /OPT:NOREF")
 else()
-  set(CMAKE_CXX_FLAGS_COMMON "-g -Wall -Wextra -std=gnu++17")
+  set(CMAKE_CXX_FLAGS_COMMON "-Wall -Wextra -std=gnu++17")
   set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${CMAKE_CXX_FLAGS_COMMON}")  # for cmake 3.0
   set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_COMMON}")
   set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_COMMON} -O3")
@@ -519,6 +532,8 @@ watchman/thirdparty/jansson/value.cpp
 )
 target_link_libraries(jansson string third_party_deps)
 
+if (BUILD_TESTING)
+
 list(APPEND testsupport_sources
 watchman/ChildProcess.cpp
 watchman/fs/FileDescriptor.cpp
@@ -546,6 +561,8 @@ watchman/root/file.cpp
 add_library(testsupport STATIC ${testsupport_sources})
 target_link_libraries(testsupport log string jansson third_party_deps)
 
+endif()
+
 if (ENABLE_EDEN_SUPPORT)
   add_fbthrift_cpp_library(
     eden_config_thrift
@@ -731,6 +748,8 @@ install(TARGETS watchman RUNTIME DESTINATION bin)
 
 add_subdirectory(watchman/cli)
 
+if (BUILD_TESTING)
+
 set(tests)
 # Helper function to define a unit test executable
 function(t_test NAME)
@@ -784,3 +803,5 @@ t_test(result watchman/test/ResultTest.cpp)
 t_test(ringbuffer watchman/test/RingBufferTest.cpp)
 t_test(string watchman/test/StringTest.cpp)
 t_test(wildmatch watchman/test/WildmatchTest.cpp)
+
+endif()
diff --git a/build/fbcode_builder/CMake/FBCompilerSettingsUnix.cmake b/build/fbcode_builder/CMake/FBCompilerSettingsUnix.cmake
index c26ce78..dacc0b1 100644
--- a/build/fbcode_builder/CMake/FBCompilerSettingsUnix.cmake
+++ b/build/fbcode_builder/CMake/FBCompilerSettingsUnix.cmake
@@ -6,4 +6,4 @@
 # to these shared compiler settings in order to avoid accidentally
 # breaking a build in another project!
 
-set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g -Wall -Wextra -Wno-deprecated -Wno-deprecated-declarations")
+set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wextra -Wno-deprecated -Wno-deprecated-declarations")
